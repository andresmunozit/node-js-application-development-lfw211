'USE STRICT'
CONST { PIPELINE } = REQUIRE('STREAM')
CONST { JOIN } = REQUIRE('PATH')
CONST { CREATEREADSTREAM, CREATEWRITESTREAM } = REQUIRE('FS')
CONST { TRANSFORM } = REQUIRE('STREAM')
// CUSTOM STREAM TO CONVERT INPUT TEXT TO UPPERCASE
CONST CREATEUPPERCASESTREAM = () => {
    RETURN NEW TRANSFORM({
        TRANSFORM(CHUNK, ENC, NEXT){
            CONST UPPERCASED = CHUNK.TOSTRING().TOUPPERCASE()
            NEXT(NULL, UPPERCASED)
        }
    })
}
PIPELINE(
    CREATEREADSTREAM(__FILENAME), // READ FROM THE CURRENT FILE IN CHUNKS
    CREATEUPPERCASESTREAM(), // CONVERT EACH CHUNK TO UPPERCASE
    CREATEWRITESTREAM(JOIN(__DIRNAME, 'OUT.TXT')),  // WRITE TRANSFORMED CHUNKS TO 'OUT.TXT'
    (ERR) => {
        IF (ERR) {
            CONSOLE.ERROR(ERR)
            RETURN
        }
        CONSOLE.LOG('FINISHED WRITING')
    }
)
